schema-version: 1.0

type: builder


const:
  srcDir: /usr/src
  exportDir: /opt/gmp

dependencies:
  - m4
  - texinfo
  - perl

provision:
  - url:
      from: https://ftp.gnu.org/gnu/gmp/gmp-{% version %}.tar.xz
      todir: "{% srcDir %}"
  - env: PERL5LIB=/usr/share/texinfo:/usr/share/texinfo/lib/libintl-perl/lib:/usr/share/texinfo/lib/Text-Unidecode/lib:/usr/share/texinfo/lib/Unicode-EastAsianWidth/lib

build:
  - shell:
      cmds:
        - ./configure --prefix=/usr
            --enable-cxx
            --disable-static
            --docdir=/usr/share/doc/gmp-{% version %}
        - make
        - make html
#       - make check 2>&1 | tee gmp-check-log
#        - awk '/# PASS:/{total+=$3} ; END{print total}' gmp-check-log
        - make install DESTDIR={% exportDir %}
        - make install-html DESTDIR={% exportDir %}
      directory: "{% srcDir %}/gmp-{% version %}"
  - export: "{% exportDir %}"

